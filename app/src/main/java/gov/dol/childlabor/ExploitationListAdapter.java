package gov.dol.childlabor;

import android.content.Context;
import android.view.LayoutInflater;
import android.view.View;
import android.view.ViewGroup;
import android.widget.ArrayAdapter;
import android.widget.ImageView;
import android.widget.LinearLayout;
import android.widget.TextView;

/**
 * Created by tru on 10/28/2015.
 */
public class ExploitationListAdapter extends ArrayAdapter<Country> {
    private LayoutInflater inflater;
    private int sectionNumber;
    public Integer expgoodcount;

    public ExploitationListAdapter(Context context, Country[] values, int sectionNumber) {
        super(context, R.layout.country_list_row, values);
        inflater = LayoutInflater.from(context);
        this.sectionNumber = sectionNumber;
    }

    @Override
    public View getView(int position, View convertView, ViewGroup parent) {
        ExploitationViewHolder holder;
        if (convertView == null) {
            holder = new ExploitationViewHolder();
            convertView = inflater.inflate(R.layout.exploitation_type_list_row, parent, false);
            holder.text = (TextView) convertView.findViewById(R.id.exploitationListTextView);
            holder.list = (LinearLayout) convertView.findViewById(R.id.exploitationListGoodLinearLayout);
            convertView.setTag(holder);
        } else {
            holder = (ExploitationViewHolder) convertView.getTag();
        }

        Country country = getItem(position);
        holder.country = country;


        expgoodcount = 0;
        CountryGood[] goods;
        switch(sectionNumber) {
            case 2:
                goods = country.getChildLaborGoods();
                break;
            case 3:
                goods = country.getForcedLaborGoods();
                break;
            case 4:
                goods = country.getForcedChildLaborGoods();
                break;
            case 5:
                goods = country.getDerivedExploitationLaborGoods();
                break;
            default:
                goods = country.getGoods();
        }
        expgoodcount = goods.length;

        TextView countryTextView = holder.text;
        countryTextView.setText(country.getName() );
        countryTextView.setContentDescription(country.getName() + ", Button" + " There are " + expgoodcount + " goods produced using exploitative labor for this country" );
        countryTextView.setTag(country);
        addGoods(holder, goods);

        return convertView;
    }

    public void addGoods(ExploitationViewHolder holder, CountryGood[] countryGoods) {
        LinearLayout goodLinearLayout = holder.list;

        goodLinearLayout.removeAllViews();
        for (CountryGood good : countryGoods) {

            View countryGoodWidget = inflater.inflate(R.layout.exploitation_list_good_widget, goodLinearLayout, false);
            countryGoodWidget.setTag(good);

            ImageView countryGoodImageView = (ImageView) countryGoodWidget.findViewById(R.id.exploitationListGoodImageView);
            countryGoodImageView.setImageDrawable(AppHelpers.getGoodDrawable(getContext(), good.getGoodName()));
            String imageDescription = good.getGoodName();

            ImageView exploitationImageView,dlView = null;
            if(good.hasForcedChildLabor()) {
                exploitationImageView = (ImageView) countryGoodWidget.findViewById(R.id.exploitationListForcedChildLaborImageView);
                exploitationImageView.setVisibility(View.VISIBLE);
                imageDescription += ", Forced Child Labor";
            }
            else if(good.hasChildLabor()) {
                exploitationImageView = (ImageView) countryGoodWidget.findViewById(R.id.exploitationListChildLaborImageView);
                exploitationImageView.setVisibility(View.VISIBLE);
                imageDescription += ", Child Labor";
            }
            else {
                exploitationImageView = (ImageView) countryGoodWidget.findViewById(R.id.exploitationListForcedChildLaborImageView);
                exploitationImageView.setVisibility(View.INVISIBLE);
            }

            if(good.hasForcedLabor()) {
                exploitationImageView = (ImageView) countryGoodWidget.findViewById(R.id.exploitationListForcedLaborImageView);
                exploitationImageView.setVisibility(View.VISIBLE);
                imageDescription += ", Forced Labor";
            }
            if(good.getHasDerivedLaborExploitation()) {
                exploitationImageView = (ImageView) countryGoodWidget.findViewById(R.id.derived_exploitation);
                dlView = (ImageView) countryGoodWidget.findViewById(R.id.derived_exploitation2);
                exploitationImageView.setVisibility(View.VISIBLE);
                dlView.setVisibility(View.VISIBLE);
                imageDescription += ", Derived Exploitation Labor";
                exploitationImageView.setImageDrawable(AppHelpers.getFlagDrawable(getContext(), good.getDerivedCountry()));
            }else{
                exploitationImageView = (ImageView) countryGoodWidget.findViewById(R.id.derived_exploitation);
                dlView = (ImageView) countryGoodWidget.findViewById(R.id.derived_exploitation2);
                exploitationImageView.setVisibility(View.INVISIBLE);
                dlView.setVisibility(View.INVISIBLE);
            }

            countryGoodImageView.setContentDescription(imageDescription + ", Button");
            goodLinearLayout.addView(countryGoodWidget);
        }
    }

    class ExploitationViewHolder {
        TextView text;
        LinearLayout list;
        Country country;
    }

}
